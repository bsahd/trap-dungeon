var W,v,fe,Ge,M,ce,pe,de,me,ee,Y,Z,Ve,P={},ge=[],We=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,B=Array.isArray;function j(t,e){for(var r in e)t[r]=e[r];return t}function te(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function x(t,e,r){var i,s,o,n={};for(o in e)o=="key"?i=e[o]:o=="ref"?s=e[o]:n[o]=e[o];if(arguments.length>2&&(n.children=arguments.length>3?W.call(arguments,2):r),typeof t=="function"&&t.defaultProps!=null)for(o in t.defaultProps)n[o]===void 0&&(n[o]=t.defaultProps[o]);return $(t,n,i,s,null)}function $(t,e,r,i,s){var o={type:t,props:e,key:r,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:s??++fe,__i:-1,__u:0};return s==null&&v.vnode!=null&&v.vnode(o),o}function L(t){return t.children}function G(t,e){this.props=t,this.context=e}function R(t,e){if(e==null)return t.__?R(t.__,t.__i+1):null;for(var r;e<t.__k.length;e++)if((r=t.__k[e])!=null&&r.__e!=null)return r.__e;return typeof t.type=="function"?R(t):null}function ye(t){var e,r;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((r=t.__k[e])!=null&&r.__e!=null){t.__e=t.__c.base=r.__e;break}return ye(t)}}function _e(t){(!t.__d&&(t.__d=!0)&&M.push(t)&&!V.__r++||ce!=v.debounceRendering)&&((ce=v.debounceRendering)||pe)(V)}function V(){for(var t,e,r,i,s,o,n,l=1;M.length;)M.length>l&&M.sort(de),t=M.shift(),l=M.length,t.__d&&(r=void 0,s=(i=(e=t).__v).__e,o=[],n=[],e.__P&&((r=j({},i)).__v=i.__v+1,v.vnode&&v.vnode(r),re(e.__P,r,i,e.__n,e.__P.namespaceURI,32&i.__u?[s]:null,o,s??R(i),!!(32&i.__u),n),r.__v=i.__v,r.__.__k[r.__i]=r,we(o,r,n),r.__e!=s&&ye(r)));V.__r=0}function ve(t,e,r,i,s,o,n,l,_,c,h){var a,u,f,p,d,m,g,y=i&&i.__k||ge,A=e.length;for(_=Be(r,e,y,_,A),a=0;a<A;a++)(f=r.__k[a])!=null&&(u=f.__i==-1?P:y[f.__i]||P,f.__i=a,m=re(t,f,u,s,o,n,l,_,c,h),p=f.__e,f.ref&&u.ref!=f.ref&&(u.ref&&ie(u.ref,null,f),h.push(f.ref,f.__c||p,f)),d==null&&p!=null&&(d=p),(g=!!(4&f.__u))||u.__k===f.__k?_=be(f,_,t,g):typeof f.type=="function"&&m!==void 0?_=m:p&&(_=p.nextSibling),f.__u&=-7);return r.__e=d,_}function Be(t,e,r,i,s){var o,n,l,_,c,h=r.length,a=h,u=0;for(t.__k=new Array(s),o=0;o<s;o++)(n=e[o])!=null&&typeof n!="boolean"&&typeof n!="function"?(_=o+u,(n=t.__k[o]=typeof n=="string"||typeof n=="number"||typeof n=="bigint"||n.constructor==String?$(null,n,null,null,null):B(n)?$(L,{children:n},null,null,null):n.constructor==null&&n.__b>0?$(n.type,n.props,n.key,n.ref?n.ref:null,n.__v):n).__=t,n.__b=t.__b+1,l=null,(c=n.__i=Je(n,r,_,a))!=-1&&(a--,(l=r[c])&&(l.__u|=2)),l==null||l.__v==null?(c==-1&&(s>h?u--:s<h&&u++),typeof n.type!="function"&&(n.__u|=4)):c!=_&&(c==_-1?u--:c==_+1?u++:(c>_?u--:u++,n.__u|=4))):t.__k[o]=null;if(a)for(o=0;o<h;o++)(l=r[o])!=null&&(2&l.__u)==0&&(l.__e==i&&(i=R(l)),Ie(l,l));return i}function be(t,e,r,i){var s,o;if(typeof t.type=="function"){for(s=t.__k,o=0;s&&o<s.length;o++)s[o]&&(s[o].__=t,e=be(s[o],e,r,i));return e}t.__e!=e&&(i&&(e&&t.type&&!e.parentNode&&(e=R(t)),r.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function Je(t,e,r,i){var s,o,n,l=t.key,_=t.type,c=e[r],h=c!=null&&(2&c.__u)==0;if(c===null&&t.key==null||h&&l==c.key&&_==c.type)return r;if(i>(h?1:0)){for(s=r-1,o=r+1;s>=0||o<e.length;)if((c=e[n=s>=0?s--:o++])!=null&&(2&c.__u)==0&&l==c.key&&_==c.type)return n}return-1}function ue(t,e,r){e[0]=="-"?t.setProperty(e,r??""):t[e]=r==null?"":typeof r!="number"||We.test(e)?r:r+"px"}function O(t,e,r,i,s){var o,n;e:if(e=="style")if(typeof r=="string")t.style.cssText=r;else{if(typeof i=="string"&&(t.style.cssText=i=""),i)for(e in i)r&&e in r||ue(t.style,e,"");if(r)for(e in r)i&&r[e]==i[e]||ue(t.style,e,r[e])}else if(e[0]=="o"&&e[1]=="n")o=e!=(e=e.replace(me,"$1")),n=e.toLowerCase(),e=n in t||e=="onFocusOut"||e=="onFocusIn"?n.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+o]=r,r?i?r.u=i.u:(r.u=ee,t.addEventListener(e,o?Z:Y,o)):t.removeEventListener(e,o?Z:Y,o);else{if(s=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=r??"";break e}catch{}typeof r=="function"||(r==null||r===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&r==1?"":r))}}function he(t){return function(e){if(this.l){var r=this.l[e.type+t];if(e.t==null)e.t=ee++;else if(e.t<r.u)return;return r(v.event?v.event(e):e)}}}function re(t,e,r,i,s,o,n,l,_,c){var h,a,u,f,p,d,m,g,y,A,C,q,D,le,U,H,z,F=e.type;if(e.constructor!=null)return null;128&r.__u&&(_=!!(32&r.__u),o=[l=e.__e=r.__e]),(h=v.__b)&&h(e);e:if(typeof F=="function")try{if(g=e.props,y="prototype"in F&&F.prototype.render,A=(h=F.contextType)&&i[h.__c],C=h?A?A.props.value:h.__:i,r.__c?m=(a=e.__c=r.__c).__=a.__E:(y?e.__c=a=new F(g,C):(e.__c=a=new G(g,C),a.constructor=F,a.render=Xe),A&&A.sub(a),a.props=g,a.state||(a.state={}),a.context=C,a.__n=i,u=a.__d=!0,a.__h=[],a._sb=[]),y&&a.__s==null&&(a.__s=a.state),y&&F.getDerivedStateFromProps!=null&&(a.__s==a.state&&(a.__s=j({},a.__s)),j(a.__s,F.getDerivedStateFromProps(g,a.__s))),f=a.props,p=a.state,a.__v=e,u)y&&F.getDerivedStateFromProps==null&&a.componentWillMount!=null&&a.componentWillMount(),y&&a.componentDidMount!=null&&a.__h.push(a.componentDidMount);else{if(y&&F.getDerivedStateFromProps==null&&g!==f&&a.componentWillReceiveProps!=null&&a.componentWillReceiveProps(g,C),!a.__e&&a.shouldComponentUpdate!=null&&a.shouldComponentUpdate(g,a.__s,C)===!1||e.__v==r.__v){for(e.__v!=r.__v&&(a.props=g,a.state=a.__s,a.__d=!1),e.__e=r.__e,e.__k=r.__k,e.__k.some(function(N){N&&(N.__=e)}),q=0;q<a._sb.length;q++)a.__h.push(a._sb[q]);a._sb=[],a.__h.length&&n.push(a);break e}a.componentWillUpdate!=null&&a.componentWillUpdate(g,a.__s,C),y&&a.componentDidUpdate!=null&&a.__h.push(function(){a.componentDidUpdate(f,p,d)})}if(a.context=C,a.props=g,a.__P=t,a.__e=!1,D=v.__r,le=0,y){for(a.state=a.__s,a.__d=!1,D&&D(e),h=a.render(a.props,a.state,a.context),U=0;U<a._sb.length;U++)a.__h.push(a._sb[U]);a._sb=[]}else do a.__d=!1,D&&D(e),h=a.render(a.props,a.state,a.context),a.state=a.__s;while(a.__d&&++le<25);a.state=a.__s,a.getChildContext!=null&&(i=j(j({},i),a.getChildContext())),y&&!u&&a.getSnapshotBeforeUpdate!=null&&(d=a.getSnapshotBeforeUpdate(f,p)),H=h,h!=null&&h.type===L&&h.key==null&&(H=xe(h.props.children)),l=ve(t,B(H)?H:[H],e,r,i,s,o,n,l,_,c),a.base=e.__e,e.__u&=-161,a.__h.length&&n.push(a),m&&(a.__E=a.__=null)}catch(N){if(e.__v=null,_||o!=null)if(N.then){for(e.__u|=_?160:128;l&&l.nodeType==8&&l.nextSibling;)l=l.nextSibling;o[o.indexOf(l)]=null,e.__e=l}else{for(z=o.length;z--;)te(o[z]);Q(e)}else e.__e=r.__e,e.__k=r.__k,N.then||Q(e);v.__e(N,e,r)}else o==null&&e.__v==r.__v?(e.__k=r.__k,e.__e=r.__e):l=e.__e=Ke(r.__e,e,r,i,s,o,n,_,c);return(h=v.diffed)&&h(e),128&e.__u?void 0:l}function Q(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(Q)}function we(t,e,r){for(var i=0;i<r.length;i++)ie(r[i],r[++i],r[++i]);v.__c&&v.__c(e,t),t.some(function(s){try{t=s.__h,s.__h=[],t.some(function(o){o.call(s)})}catch(o){v.__e(o,s.__v)}})}function xe(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:B(t)?t.map(xe):j({},t)}function Ke(t,e,r,i,s,o,n,l,_){var c,h,a,u,f,p,d,m=r.props,g=e.props,y=e.type;if(y=="svg"?s="http://www.w3.org/2000/svg":y=="math"?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),o!=null){for(c=0;c<o.length;c++)if((f=o[c])&&"setAttribute"in f==!!y&&(y?f.localName==y:f.nodeType==3)){t=f,o[c]=null;break}}if(t==null){if(y==null)return document.createTextNode(g);t=document.createElementNS(s,y,g.is&&g),l&&(v.__m&&v.__m(e,o),l=!1),o=null}if(y==null)m===g||l&&t.data==g||(t.data=g);else{if(o=o&&W.call(t.childNodes),m=r.props||P,!l&&o!=null)for(m={},c=0;c<t.attributes.length;c++)m[(f=t.attributes[c]).name]=f.value;for(c in m)if(f=m[c],c!="children"){if(c=="dangerouslySetInnerHTML")a=f;else if(!(c in g)){if(c=="value"&&"defaultValue"in g||c=="checked"&&"defaultChecked"in g)continue;O(t,c,null,f,s)}}for(c in g)f=g[c],c=="children"?u=f:c=="dangerouslySetInnerHTML"?h=f:c=="value"?p=f:c=="checked"?d=f:l&&typeof f!="function"||m[c]===f||O(t,c,f,m[c],s);if(h)l||a&&(h.__html==a.__html||h.__html==t.innerHTML)||(t.innerHTML=h.__html),e.__k=[];else if(a&&(t.innerHTML=""),ve(e.type=="template"?t.content:t,B(u)?u:[u],e,r,i,y=="foreignObject"?"http://www.w3.org/1999/xhtml":s,o,n,o?o[0]:r.__k&&R(r,0),l,_),o!=null)for(c=o.length;c--;)te(o[c]);l||(c="value",y=="progress"&&p==null?t.removeAttribute("value"):p!=null&&(p!==t[c]||y=="progress"&&!p||y=="option"&&p!=m[c])&&O(t,c,p,m[c],s),c="checked",d!=null&&d!=t[c]&&O(t,c,d,m[c],s))}return t}function ie(t,e,r){try{if(typeof t=="function"){var i=typeof t.__u=="function";i&&t.__u(),i&&e==null||(t.__u=t(e))}else t.current=e}catch(s){v.__e(s,r)}}function Ie(t,e,r){var i,s;if(v.unmount&&v.unmount(t),(i=t.ref)&&(i.current&&i.current!=t.__e||ie(i,null,e)),(i=t.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(o){v.__e(o,e)}i.base=i.__P=null}if(i=t.__k)for(s=0;s<i.length;s++)i[s]&&Ie(i[s],e,r||typeof t.type!="function");r||te(t.__e),t.__c=t.__=t.__e=void 0}function Xe(t,e,r){return this.constructor(t,r)}function Se(t,e,r){var i,s,o,n;e==document&&(e=document.documentElement),v.__&&v.__(t,e),s=(i=typeof r=="function")?null:r&&r.__k||e.__k,o=[],n=[],re(e,t=(!i&&r||e).__k=x(L,null,[t]),s||P,P,e.namespaceURI,!i&&r?[r]:s?null:e.firstChild?W.call(e.childNodes):null,o,!i&&r?r:s?s.__e:e.firstChild,i,n),we(o,t,n)}W=ge.slice,v={__e:function(t,e,r,i){for(var s,o,n;e=e.__;)if((s=e.__c)&&!s.__)try{if((o=s.constructor)&&o.getDerivedStateFromError!=null&&(s.setState(o.getDerivedStateFromError(t)),n=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(t,i||{}),n=s.__d),n)return s.__E=s}catch(l){t=l}throw t}},fe=0,Ge=function(t){return t!=null&&t.constructor==null},G.prototype.setState=function(t,e){var r;r=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=j({},this.state),typeof t=="function"&&(t=t(j({},r),this.props)),t&&j(r,t),t!=null&&this.__v&&(e&&this._sb.push(e),_e(this))},G.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),_e(this))},G.prototype.render=L,M=[],pe=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,de=function(t,e){return t.__v.__b-e.__v.__b},V.__r=0,me=/(PointerCapture)$|Capture$/i,ee=0,Y=he(!1),Z=he(!0),Ve=0;function Te(t,e,r,i){let s=[],o=Math.abs(i-e),n=-Math.abs(r-t),l=e<i?1:-1,_=t<r?1:-1,c=o+n;for(;s.push({r:t,c:e}),!(t===r&&e===i);){let h=2*c;h>=n&&(c+=n,e+=l),h<=o&&(c+=o,t+=_)}return s}function I(t,e,r,i){return t>=0&&t<r&&e>=0&&e<i}function S(t,e,r,i){let s=[];for(let o=-1;o<=1;o++)for(let n=-1;n<=1;n++){if(o===0&&n===0)continue;let l=t+o,_=e+n;I(l,_,r,i)&&s.push({r:l,c:_})}return s}function E(t,e){let r=t.length;if(r===0)return;let i=t[0].length;for(let s=0;s<r;s++)for(let o=0;o<i;o++)e(t[s][o],s,o)}function ke(t,e,r,i,s){let o=t.length,n=t[0].length,l=Array.from({length:o},()=>Array(n).fill(!1)),_=[{r:e,c:r}];if(!I(e,r,o,n)||t[e][r].isTrap||!I(i,s,o,n)||t[i][s].isTrap)return!1;l[e][r]=!0;let c=[-1,1,0,0],h=[0,0,-1,1];for(;_.length>0;){let{r:a,c:u}=_.shift();if(a===i&&u===s)return!0;for(let f=0;f<4;f++){let p=a+c[f],d=u+h[f];I(p,d,o,n)&&!l[p][d]&&!t[p][d].isTrap&&(l[p][d]=!0,_.push({r:p,c:d}))}}return!1}function Fe(t,e,r,i,s){let o=t.length,n=t[0].length,l=Array.from({length:o},()=>Array(n).fill(!1)),_=[{r:e,c:r}];if(e===i&&r===s)return!0;l[e][r]=!0;let c=[-1,-1,-1,0,0,1,1,1],h=[-1,0,1,-1,1,-1,0,1];for(;_.length>0;){let{r:a,c:u}=_.shift();if(S(a,u,o,n).some(p=>p.r===i&&p.c===s))return!0;if(!(t[a][u].adjacentTraps>0&&!(a===e&&u===r)))for(let p=0;p<8;p++){let d=a+c[p],m=u+h[p];I(d,m,o,n)&&!l[d][m]&&!t[d][m].isTrap&&(l[d][m]=!0,_.push({r:d,c:m}))}}return!1}var k={reveal_one_trap:{name:{ja:"\u5343\u91CC\u773C\u306E\u5DFB\u7269",en:"Scroll of Clairvoyance"},description:{ja:"\u30D7\u30EC\u30A4\u30E4\u30FC\u306E\u5468\u56F28\u30DE\u30B9\u306B\u3042\u308B\u7F60\u3092\u3059\u3079\u3066\u660E\u3089\u304B\u306B\u3059\u308B\u3002",en:"Reveals all traps within 8 squares of the player."},key:"r",minFloor:1,maxFloor:1/0,use:function(t){let e=S(t.player.r,t.player.c,t.rows,t.cols);for(let r of e){let i=t.grid[r.r][r.c];i.isTrap?(i.isRevealed=!0,i.isFlagged=!0):"revealFrom"in t&&t.revealFrom(r.r,r.c)}return{consumed:!0}}},trap_shield:{name:{ja:"\u9244\u306E\u5FC3\u81D3",en:"Heart of Iron"},description:{ja:"\u7F60\u3092\u8E0F\u3093\u3060\u6642\u306B1\u5EA6\u3060\u3051\u8EAB\u4EE3\u308F\u308A\u306B\u306A\u308B\u3002(\u30D1\u30C3\u30B7\u30D6)",en:"When stepping on a trap, you can become a substitute once. (Passive)"},key:null,minFloor:1,maxFloor:1/0},reduce_traps:{name:{ja:"\u89E3\u4F53\u306E\u624B\u5F15\u304D",en:"Disassembly Guide"},description:{ja:"\u30E9\u30F3\u30C0\u30E0\u306A\u7F601\u3064\u3092\u7121\u52B9\u5316\u3059\u308B\u3002",en:"Disables one random trap."},key:"t",minFloor:1,maxFloor:10,use:function(t){let r=S(t.player.r,t.player.c,t.rows,t.cols).filter(i=>t.grid[i.r][i.c].isTrap);if(r.length>0){let i=r[Math.floor(Math.random()*r.length)],s=t.grid[i.r][i.c];s.isTrap=!1,s.isFlagged=!1,"calculateNumbers"in t&&t.calculateNumbers()}return{consumed:!0}}},reveal_exit:{name:{ja:"\u51FA\u53E3\u306E\u5730\u56F3",en:"Map of Exit"},description:{ja:"\u73FE\u5728\u306E\u30D5\u30ED\u30A2\u306E\u51FA\u53E3(E)\u306E\u4F4D\u7F6E\u3092\u660E\u3089\u304B\u306B\u3059\u308B\u3002",en:"Reveal the location of exit(E) on the current floor."},key:"e",minFloor:1,maxFloor:8,use:function(t){return t.exitRevealedThisFloor?{consumed:!1,message:{ja:"\u51FA\u53E3\u306F\u3059\u3067\u306B\u5224\u660E\u3057\u3066\u3044\u308B\u3002",en:"The exit is already revealed."}}:(t.exitRevealedThisFloor=!0,{consumed:!0})}},long_jump:{name:{ja:"\u8DF3\u8E8D\u306E\u30D6\u30FC\u30C4",en:"Jumping Boots"},description:{ja:"\u6307\u5B9A\u3057\u305F\u65B9\u5411\u306B1\u30DE\u30B9\u98DB\u3073\u8D8A\u3048\u3066\u30012\u30DE\u30B9\u5148\u306B\u9032\u3080\u3002",en:"Jump one square in the specified direction and move two squares forward."},key:"j",minFloor:1,maxFloor:1/0,use:function(t){return t.gameState="jumping_direction",{consumed:!1}}},recon_drone:{name:{ja:"\u5075\u5BDF\u30C9\u30ED\u30FC\u30F3",en:"Reconnaissance Drone"},description:{ja:"\u4F7F\u7528\u6642\u3001\u4E0A\u4E0B\u5DE6\u53F3\u306E\u3044\u305A\u308C\u304B\u306E\u65B9\u5411\u3092\u6307\u5B9A\u3059\u308B\u3002\u30C9\u30ED\u30FC\u30F3\u304C\u305D\u306E\u65B9\u5411\u3078\u4E00\u76F4\u7DDA\u306B\u98DB\u3073\u3001\u901A\u8DEF\uFF08\u6570\u5B57\u304C\u66F8\u304B\u308C\u305F\u30DE\u30B9\uFF09\u3092\u6B21\u3005\u3068\u958B\u793A\u3057\u3066\u3044\u304F\u3002\u3082\u3057\u9032\u8DEF\u4E0A\u306B\u7F60\u304C\u3042\u3063\u305F\u5834\u5408\u3001\u305D\u306E\u7F60\u3092\u958B\u793A\u3057\u3066\u505C\u6B62\u3059\u308B\u3002",en:"When used, you can choose a direction: up, down, left, or right. The drone will fly in a straight line in that direction, revealing passages (squares with numbers written on them) one after another. If there is a trap in its path, it will reveal the trap and stop."},key:"c",minFloor:5,maxFloor:1/0,use:function(t){return t.gameState="recon_direction",{consumed:!1}}},ariadnes_thread:{name:{ja:"\u30A2\u30EA\u30A2\u30C9\u30CD\u306E\u7CF8",en:"Ariadne's Thread"},description:{ja:"\u4F7F\u7528\u3059\u308B\u3068\u3001\u30D7\u30EC\u30A4\u30E4\u30FC\u304B\u3089\u51FA\u53E3\u307E\u3067\u306E\u300C\u6700\u77ED\u7D4C\u8DEF\u300D\u304C\u30DE\u30C3\u30D7\u4E0A\u306B\u793A\u3055\u308C\u308B\u3002\u7D4C\u8DEF\u4E0A\u306E\u30DE\u30B9\u306F\u3059\u3079\u3066\u958B\u793A\u3055\u308C\u308B\u304C\u3001\u305D\u3053\u306B\u3042\u308B\u7F60\u3082\u3059\u3079\u3066\u8868\u793A\u3055\u308C\u308B\u3002",en:'When used, the "shortest path" from the player to the exit is displayed on the map, revealing all squares along the path, including any traps.'},key:"g",minFloor:5,maxFloor:1/0,use:function(t){let e=Te(t.player.r,t.player.c,t.exit.r,t.exit.c);return e&&e.length>0&&e.forEach(r=>{let i=t.grid[r.r][r.c];i.isRevealed=!0,i.isTrap?i.isFlagged=!0:i.isFlagged=!1}),{consumed:!0}}},detailed_map_of_exit:{name:{ja:"\u8A73\u7D30\u306A\u51FA\u53E3\u306E\u5730\u56F3",en:"Detailed exit map"},description:{ja:"\u51FA\u53E3\u306E\u4F4D\u7F6E\u3092\u660E\u3089\u304B\u306B\u3059\u308B\u3068\u540C\u6642\u306B\u3001\u51FA\u53E3\u306B\u96A3\u63A5\u3059\u308B\u5468\u56F28\u30DE\u30B9\u306E\u72B6\u614B\u3082\u3059\u3079\u3066\u958B\u793A\u3059\u308B\u3002",en:"When revealing the location of the exit, the state of all eight squares surrounding the exit is also revealed."},key:"x",minFloor:5,maxFloor:1/0,use:function(t){let e=S(t.exit.r,t.exit.c,t.rows,t.cols);if(e.push({r:t.exit.r,c:t.exit.c}),e.some(i=>I(i.r,i.c,t.rows,t.cols)&&!t.grid[i.r][i.c].isRevealed)){t.exitRevealedThisFloor=!0;for(let i of e)I(i.r,i.c,t.rows,t.cols)&&"revealFrom"in t&&t.revealFrom(i.r,i.c);return{consumed:!0}}else return{consumed:!1,message:{ja:"\u51FA\u53E3\u306E\u5468\u56F2\u306F\u3059\u3079\u3066\u5224\u660E\u3057\u3066\u3044\u308B\u3002",en:"The entire area surrounding the exit is revealed."}}}},philosophers_stone:{name:{ja:"\u8CE2\u8005\u306E\u77F3",en:"Philosopher's Stone"},description:{ja:"\u4F7F\u7528\u3059\u308B\u3068\u3001\u30D7\u30EC\u30A4\u30E4\u30FC\u306E\u5468\u56F25x5\u306E\u5E83\u5927\u306A\u7BC4\u56F2\u3092\u4E00\u5EA6\u306B\u958B\u793A\u3059\u308B\u3002",en:"When used, it reveals a vast 5x5 area around the player at once."},key:"p",minFloor:10,maxFloor:1/0,use:function(t){for(let e=-2;e<=2;e++)for(let r=-2;r<=2;r++){let i=t.player.r+e,s=t.player.c+r;I(i,s,t.rows,t.cols)&&"revealFrom"in t&&t.revealFrom(i,s)}return{consumed:!0}}},scroll_of_chaos:{name:{ja:"\u7121\u79E9\u5E8F\u306E\u5DFB\u7269",en:"Scroll of Chaos"},description:{ja:"\u4F7F\u7528\u3059\u308B\u3068\u3001\u307E\u3060\u958B\u793A\u3082\u30D5\u30E9\u30B0\u3082\u3055\u308C\u3066\u3044\u306A\u3044\u5168\u3066\u306E\u30DE\u30B9\u3067\u3001\u7F60\u306E\u914D\u7F6E\u3092\u30B7\u30E3\u30C3\u30D5\u30EB\uFF08\u518D\u914D\u7F6E\uFF09\u3059\u308B\u3002\u7F60\u306E\u7DCF\u6570\u306F\u5909\u308F\u3089\u306A\u3044\u3002",en:"When used, it shuffles (rearranges) trap placements on all squares that have not yet been revealed or flagged, but the total number of traps remains the same."},key:"k",minFloor:10,maxFloor:1/0,use:function(t){let e=[];E(t.grid,(o,n,l)=>{(n===t.exit.r&&l===t.exit.c||o.itemId)&&e.push({r:n,c:l})});let r=new Set;e.forEach(o=>{r.add(`${o.r},${o.c}`),S(o.r,o.c,t.rows,t.cols).forEach(l=>r.add(`${l.r},${l.c}`))});let i=[],s=0;E(t.grid,(o,n,l)=>{!o.isRevealed&&!o.isFlagged&&!r.has(`${n},${l}`)&&(i.push(o),o.isTrap&&(s++,o.isTrap=!1))});for(let o=i.length-1;o>0;o--){let n=Math.floor(Math.random()*(o+1));[i[o],i[n]]=[i[n],i[o]]}for(let o=0;o<s;o++)i[o].isTrap=!0;return"calculateNumbers"in t&&t.calculateNumbers(),{consumed:!0}}}};var J=class{grid=[];rows=8;cols=8;player={r:0,c:0,items:[]};exit={r:0,c:0};floorNumber=1;turn=0;gameState="playing";exitRevealedThisFloor=!1;REVELATION_THRESHOLD=.5;uiEffect=null;justAcquiredItem=null;currentItemChoices=[];floorRevelationRates=[];finalFloorNumber=0;finalItems=[];lastActionMessage;tutorialToShow=null;resetGame(){this.grid=[],this.rows=8,this.cols=8,this.player={r:0,c:0,items:[]},this.exit={r:0,c:0},this.floorNumber=1,this.turn=0,this.gameState="playing",this.exitRevealedThisFloor=!1,this.justAcquiredItem=null,this.currentItemChoices=[],this.floorRevelationRates=[],this.finalFloorNumber=0,this.finalItems=[],this.lastActionMessage=void 0,this.tutorialToShow=null}getAvailableItems(){let e=this.floorNumber;return Object.keys(k).filter(r=>{let i=k[r],s=i.minFloor||1,o=i.maxFloor||1/0;return e>=s&&e<=o})}hasItem(e){return this.player.items.includes(e)}setupFloor(){this.player.r=Math.floor(Math.random()*this.rows),this.player.c=Math.floor(Math.random()*this.cols),Object.assign(this,{turn:0,gameState:"playing",exitRevealedThisFloor:!1}),this.floorNumber===1&&(this.floorRevelationRates=[],this.finalFloorNumber=0,this.finalItems=[]),this.floorNumber===5&&(this.tutorialToShow={title:"\u65B0\u30AE\u30DF\u30C3\u30AF\uFF1A\u898B\u901A\u3057\u306E\u60AA\u3044\u30DE\u30B9",content:`\u3053\u306E\u30D5\u30ED\u30A2\u304B\u3089\u3001\u3072\u3073\u5272\u308C\u305F\u300C\u898B\u901A\u3057\u306E\u60AA\u3044\u30DE\u30B9\u300D\u304C\u767B\u5834\u3057\u307E\u3059\u3002

\u3053\u306E\u30DE\u30B9\u306B\u8868\u793A\u3055\u308C\u308B\u6570\u5B57\u306F\u3001\u305D\u306E\u30DE\u30B9\u306E\u300C\u4E0A\u4E0B\u5DE6\u53F3\u300D4\u65B9\u5411\u306B\u3042\u308B\u7F60\u306E\u6570\u306E\u307F\u3092\u793A\u3057\u3066\u304A\u308A\u3001\u300C\u659C\u3081\u300D\u65B9\u5411\u306E\u7F60\u306F\u30AB\u30A6\u30F3\u30C8\u3057\u307E\u305B\u3093\u3002

\u958B\u793A\u3057\u3066\u521D\u3081\u3066\u5224\u660E\u3059\u308B\u305F\u3081\u3001\u6CE8\u610F\u6DF1\u304F\u63A2\u7D22\u3057\u307E\u3057\u3087\u3046\u3002`}),this.rows=8+Math.floor(this.floorNumber/3),this.cols=8+Math.floor(this.floorNumber/3);let e=8+this.floorNumber*2,r=Math.floor(this.rows*this.cols*.15),i=Math.max(e,r);if(this.floorNumber===1){let c=this.getAvailableItems().filter(h=>!this.player.items.includes(h));if(c.length>0){let h=c[Math.floor(Math.random()*c.length)];this.player.items.push(h)}}let s=!1,o=!1,n=0,l=100;do{if(n++,n>l){console.warn("Failed to generate a valid grid after",l,"attempts. Forcing generation.");break}this.generateGrid(),this.placeTraps(i),this.calculateNumbers();let _=[];if(E(this.grid,(p,d,m)=>{!p.isTrap&&p.adjacentTraps===0&&!(d===this.player.r&&m===this.player.c)&&_.push({r:d,c:m})}),_.length<2){s=!1;continue}let c=Math.floor(Math.random()*_.length),h=_.splice(c,1)[0];this.exit.r=h.r,this.exit.c=h.c;let u=this.getAvailableItems().filter(p=>k[p].key!==null),f=2;for(let p=0;p<f;p++)if(u.length>0&&_.length>0){let d=Math.floor(Math.random()*_.length),m=_.splice(d,1)[0],g=u[Math.floor(Math.random()*u.length)];this.grid[m.r][m.c].itemId=g}s=ke(this.grid,this.player.r,this.player.c,this.exit.r,this.exit.c),o=Fe(this.grid,this.player.r,this.player.c,this.exit.r,this.exit.c)}while(!s||o);if(this.floorNumber>=5){let _=[],c=new Set,h=S(this.player.r,this.player.c,this.rows,this.cols);c.add(`${this.player.r},${this.player.c}`),h.forEach(u=>c.add(`${u.r},${u.c}`)),E(this.grid,(u,f,p)=>{let d=f===this.exit.r&&p===this.exit.c;!u.isTrap&&!c.has(`${f},${p}`)&&!u.itemId&&!d&&_.push(u)});let a=Math.floor(_.length*.15);for(let u=0;u<a&&_.length!==0;u++){let f=Math.floor(Math.random()*_.length),p=_.splice(f,1)[0];p.isObscured=!0}this.calculateNumbers()}this.revealFrom(this.player.r,this.player.c)}generateGrid(){this.grid=Array.from({length:this.rows},()=>Array.from({length:this.cols},()=>({isTrap:!1,isRevealed:!1,adjacentTraps:0,isFlagged:!1,isObscured:!1})))}placeTraps(e){let r=S(this.player.r,this.player.c,this.rows,this.cols);r.push({r:this.player.r,c:this.player.c});let i=0;for(;i<e;){let s=Math.floor(Math.random()*this.rows),o=Math.floor(Math.random()*this.cols),n=r.some(_=>_.r===s&&_.c===o),l=s===this.exit.r&&o===this.exit.c;!this.grid[s][o].isTrap&&!l&&!n&&(this.grid[s][o].isTrap=!0,i++)}}calculateNumbers(){E(this.grid,(e,r,i)=>{if(e.isTrap)return;let s=0,o=S(r,i,this.rows,this.cols);if(e.isObscured){let n=o.filter(l=>l.r===r||l.c===i);for(let l of n)this.grid[l.r][l.c].isTrap&&s++}else for(let n of o)this.grid[n.r][n.c].isTrap&&s++;e.adjacentTraps=s})}revealFrom(e,r){if(!I(e,r,this.rows,this.cols)||this.grid[e][r].isRevealed)return;let i=this.grid[e][r];if(i.isRevealed=!0,i.isFlagged=!1,!i.isTrap&&i.adjacentTraps===0){let s;i.isObscured?s=S(e,r,this.rows,this.cols).filter(n=>n.r===e||n.c===r):s=S(e,r,this.rows,this.cols);for(let o of s)this.revealFrom(o.r,o.c)}}toggleFlag(e,r){if(I(e,r,this.rows,this.cols)){let i=this.grid[e][r];i.isRevealed||(i.isFlagged=!i.isFlagged)}}calculateRevelationRate(){let e=0;return E(this.grid,r=>{r.isRevealed&&e++}),e/(this.rows*this.cols)}getDisplayState(){return{grid:this.grid,player:{r:this.player.r,c:this.player.c},exit:this.exit,floorNumber:this.floorNumber,items:this.player.items,turn:this.turn,gameState:this.gameState,currentItemChoices:this.currentItemChoices,exitRevealedThisFloor:this.exitRevealedThisFloor}}handleInput(e){if(e=e.toLowerCase(),this.gameState==="confirm_next_floor")if(e==="yes"){let r=this.calculateRevelationRate();this.floorRevelationRates.push({floor:this.floorNumber,rate:r}),r<this.REVELATION_THRESHOLD?(this.lastActionMessage={ja:`\u30D5\u30ED\u30A2\u958B\u793A\u7387\u304C${(this.REVELATION_THRESHOLD*100).toFixed(0)}%\u672A\u6E80\u306E\u305F\u3081\u3001\u30A2\u30A4\u30C6\u30E0\u30DC\u30FC\u30CA\u30B9\u306F\u3042\u308A\u307E\u305B\u3093\u3067\u3057\u305F\u3002\uFF08${(r*100).toFixed(0)}%)`,en:`There were no item bonuses as the floor disclosure rate was less than ${(this.REVELATION_THRESHOLD*100).toFixed(0)}%.${(r*100).toFixed(0)}%)`},this.floorNumber++,this.setupFloor()):(this.gameState="choosing_item",this.showItemChoiceScreen())}else this.gameState="playing";else if(this.gameState==="choosing_item"){let r=parseInt(e,10)-1;if(r>=0&&r<this.currentItemChoices.length){let i=this.currentItemChoices[r];this.player.items.push(i)}return{action:"next_floor_after_delay"}}else if(this.gameState==="recon_direction"){let r=0,i=0,s=!1;switch(e){case"w":r=-1,s=!0;break;case"a":i=-1,s=!0;break;case"s":r=1,s=!0;break;case"d":i=1,s=!0;break;default:return this.gameState="playing",this.lastActionMessage={ja:"\u5075\u5BDF\u30C9\u30ED\u30FC\u30F3\u306E\u4F7F\u7528\u3092\u30AD\u30E3\u30F3\u30BB\u30EB\u3057\u307E\u3057\u305F\u3002",en:"Cancelled the use of the recon drone."},this.gameLoop()}if(s){let o=this.player.items.indexOf("recon_drone");o>-1&&this.player.items.splice(o,1);let n=this.player.r,l=this.player.c;for(;n+=r,l+=i,!!I(n,l,this.rows,this.cols);){let _=this.grid[n][l];if(_.isTrap){_.isRevealed=!0,_.isFlagged=!0;break}else this.revealFrom(n,l)}this.gameState="playing",this.turn++,this.processPlayerLocation()}}else if(this.gameState==="jumping_direction"){let r=this.player.r,i=this.player.c,s=!1;switch(e){case"w":r-=2,s=!0;break;case"a":i-=2,s=!0;break;case"s":r+=2,s=!0;break;case"d":i+=2,s=!0;break;default:return this.gameState="playing",this.lastActionMessage={ja:"\u8DF3\u8E8D\u306E\u30D6\u30FC\u30C4\u306E\u4F7F\u7528\u3092\u30AD\u30E3\u30F3\u30BB\u30EB\u3057\u307E\u3057\u305F\u3002",en:"Cancelled use of Jumping Boots."},this.gameLoop()}if(s&&I(r,i,this.rows,this.cols)){let o=this.player.items.indexOf("long_jump");o>-1&&this.player.items.splice(o,1),this.player.r=r,this.player.c=i,this.gameState="playing",this.turn++,this.processPlayerLocation()}else this.gameState="playing"}else if(this.gameState==="playing"){let r=this.player.r,i=this.player.c,s=!1,o=!1,n=Object.keys(k).find(l=>k[l].key===e);if(n&&this.hasItem(n)){let l=k[n];if(l.use){let _=l.use(this);if(o=!0,_.consumed){let c=this.player.items.indexOf(n);c>-1&&this.player.items.splice(c,1)}_.message&&(this.lastActionMessage=_.message)}}else switch(e){case"w":r--,s=!0;break;case"a":i--,s=!0;break;case"s":r++,s=!0;break;case"d":i++,s=!0;break}if(s)if(I(r,i,this.rows,this.cols)){if(this.grid[r][i].isFlagged)return this.lastActionMessage={ja:"\u30C1\u30A7\u30C3\u30AF\u3057\u305F\u30DE\u30B9\u306B\u306F\u79FB\u52D5\u3067\u304D\u307E\u305B\u3093\u3002",en:"You cannot move to a checked square."},this.gameLoop();this.player.r=r,this.player.c=i}else return this.gameLoop();(s||o&&this.gameState==="playing")&&(this.turn++,this.processPlayerLocation())}return this.gameLoop()}processPlayerLocation(){let e=this.grid[this.player.r][this.player.c];if(this.player.r===this.exit.r&&this.player.c===this.exit.c&&(this.gameState="confirm_next_floor"),e.isTrap)if(this.hasItem("trap_shield")){let r=this.player.items.indexOf("trap_shield");this.player.items.splice(r,1),e.isTrap=!1,this.calculateNumbers(),this.revealFrom(this.player.r,this.player.c),this.uiEffect="flash_red",this.lastActionMessage={ja:"\u9244\u306E\u5FC3\u81D3\u304C\u8EAB\u4EE3\u308F\u308A\u306B\u306A\u3063\u305F\uFF01",en:"The Iron Heart has taken its place!"}}else e.isRevealed=!0,this.gameState="gameover",this.lastActionMessage={ja:"\u7F60\u3092\u8E0F\u3093\u3067\u3057\u307E\u3063\u305F\uFF01",en:"I stepped into a trap!"};if(e.itemId){let r=e.itemId;this.player.items.push(r),e.itemId=void 0,this.justAcquiredItem=r}this.gameState!=="gameover"&&this.revealFrom(this.player.r,this.player.c)}showItemChoiceScreen(){let e=[],r=this.getAvailableItems();for(;e.length<3&&e.length<r.length;){let i=r[Math.floor(Math.random()*r.length)];e.includes(i)||e.push(i)}this.currentItemChoices=e}gameLoop(){if(this.gameState==="gameover")return this.finalFloorNumber=this.floorNumber,this.finalItems=[...this.player.items],{displayState:this.getDisplayState(),message:"!!! GAME OVER !!!",gameState:"gameover",result:{floorRevelationRates:this.floorRevelationRates,finalFloorNumber:this.finalFloorNumber,finalItems:this.finalItems.reduce((o,n)=>(o[n]=(o[n]||0)+1,o),{})}};let e="Move (w/a/s/d)",r=this.player.items.map(o=>k[o]).filter(o=>o.key).map(o=>`${o.key}: ${o.name}`);r.length>0&&(e+=` | Use Item (${r.join(", ")})`),e+=" > ";let i="";this.gameState==="choosing_item"?i="Floor Cleared! Choose your reward:":this.gameState==="jumping_direction"?i="Jump direction (w/a/s/d):":this.gameState==="recon_direction"?i="Recon direction (w/a/s/d):":this.gameState==="confirm_next_floor"&&(i="Go next floor?");let s={displayState:this.getDisplayState(),prompt:e,message:i,lastActionMessage:this.lastActionMessage,uiEffect:this.uiEffect,gameState:this.gameState,newItemAcquired:null,tutorialToShow:void 0};return this.justAcquiredItem&&(s.newItemAcquired={id:this.justAcquiredItem,...k[this.justAcquiredItem]}),this.tutorialToShow&&(s.tutorialToShow=this.tutorialToShow),s}clearLastActionMessage(){this.lastActionMessage=void 0}clearUiEffect(){this.uiEffect=null}clearJustAcquiredItem(){this.justAcquiredItem=null}clearTutorial(){this.tutorialToShow=null}};var X,b,oe,je,se=0,De=[],w=v,Ae=w.__b,Ce=w.__r,Ee=w.diffed,Me=w.__c,Ne=w.unmount,Re=w.__;function He(t,e){w.__h&&w.__h(b,t,se||e),se=0;var r=b.__H||(b.__H={__:[],__h:[]});return t>=r.__.length&&r.__.push({}),r.__[t]}function Pe(t){return se=1,ze(Ue,t)}function ze(t,e,r){var i=He(X++,2);if(i.t=t,!i.__c&&(i.__=[r?r(e):Ue(void 0,e),function(l){var _=i.__N?i.__N[0]:i.__[0],c=i.t(_,l);_!==c&&(i.__N=[c,i.__[1]],i.__c.setState({}))}],i.__c=b,!b.__f)){var s=function(l,_,c){if(!i.__c.__H)return!0;var h=i.__c.__H.__.filter(function(u){return!!u.__c});if(h.every(function(u){return!u.__N}))return!o||o.call(this,l,_,c);var a=i.__c.props!==l;return h.forEach(function(u){if(u.__N){var f=u.__[0];u.__=u.__N,u.__N=void 0,f!==u.__[0]&&(a=!0)}}),o&&o.call(this,l,_,c)||a};b.__f=!0;var o=b.shouldComponentUpdate,n=b.componentWillUpdate;b.componentWillUpdate=function(l,_,c){if(this.__e){var h=o;o=void 0,s(l,_,c),o=h}n&&n.call(this,l,_,c)},b.shouldComponentUpdate=s}return i.__N||i.__}function qe(t,e){var r=He(X++,3);!w.__s&&Qe(r.__H,e)&&(r.__=t,r.u=e,b.__H.__h.push(r))}function Ye(){for(var t;t=De.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(K),t.__H.__h.forEach(ne),t.__H.__h=[]}catch(e){t.__H.__h=[],w.__e(e,t.__v)}}w.__b=function(t){b=null,Ae&&Ae(t)},w.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),Re&&Re(t,e)},w.__r=function(t){Ce&&Ce(t),X=0;var e=(b=t.__c).__H;e&&(oe===b?(e.__h=[],b.__h=[],e.__.forEach(function(r){r.__N&&(r.__=r.__N),r.u=r.__N=void 0})):(e.__h.forEach(K),e.__h.forEach(ne),e.__h=[],X=0)),oe=b},w.diffed=function(t){Ee&&Ee(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(De.push(e)!==1&&je===w.requestAnimationFrame||((je=w.requestAnimationFrame)||Ze)(Ye)),e.__H.__.forEach(function(r){r.u&&(r.__H=r.u),r.u=void 0})),oe=b=null},w.__c=function(t,e){e.some(function(r){try{r.__h.forEach(K),r.__h=r.__h.filter(function(i){return!i.__||ne(i)})}catch(i){e.some(function(s){s.__h&&(s.__h=[])}),e=[],w.__e(i,r.__v)}}),Me&&Me(t,e)},w.unmount=function(t){Ne&&Ne(t);var e,r=t.__c;r&&r.__H&&(r.__H.__.forEach(function(i){try{K(i)}catch(s){e=s}}),r.__H=void 0,e&&w.__e(e,r.__v))};var Le=typeof requestAnimationFrame=="function";function Ze(t){var e,r=function(){clearTimeout(i),Le&&cancelAnimationFrame(e),setTimeout(t)},i=setTimeout(r,35);Le&&(e=requestAnimationFrame(r))}function K(t){var e=b,r=t.__c;typeof r=="function"&&(t.__c=void 0,r()),b=e}function ne(t){var e=b;t.__c=t.__(),b=e}function Qe(t,e){return!t||t.length!==e.length||e.some(function(r,i){return r!==t[i]})}function Ue(t,e){return typeof e=="function"?e(t):e}var Oe={disclosureRateAchieved:{ja:"\u958B\u793A\u7387: \u9054\u6210",en:"Disclosure rate: Achieved"},disclosureRateNotAchieved:{ja:"\u958B\u793A\u7387: \u672A\u9054\u6210",en:"Disclosure rate: Not Achieved"},itemAcquisition:{ja:"\u30A2\u30A4\u30C6\u30E0\u7372\u5F97",en:"Item Acquisition"},finalFloorReached:{ja:"\u6700\u7D42\u5230\u9054\u30D5\u30ED\u30A2",en:"Final floor reached"},possessedItems:{ja:"\u6240\u6301\u30A2\u30A4\u30C6\u30E0",en:"Possessed items"},floorDisclosureRate:{ja:"\u5404\u30D5\u30ED\u30A2\u306E\u958B\u793A\u7387",en:"Disclosure rate for each floor"},floor:{ja:"\u30D5\u30ED\u30A2",en:"Floor"},chooseReward:{ja:"\u30D5\u30ED\u30A2\u3092\u30AF\u30EA\u30A2\u3057\u307E\u3057\u305F!\u5831\u916C\u3092\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044",en:"Floor Cleared! Choose a reward"},none:{ja:"\u306A\u3057",en:"None"},noUsableItem:{ja:"\u4F7F\u7528\u3067\u304D\u308B\u30A2\u30A4\u30C6\u30E0\u304C\u3042\u308A\u307E\u305B\u3093\u3002",en:"No Usable Items."},useItem:{ja:"\u30A2\u30A4\u30C6\u30E0\u3092\u4F7F\u7528\u3059\u308B",en:"Use Item"},viewDetail:{ja:t=>t+"\u306E\u8A73\u7D30\u3092\u898B\u308B",en:t=>"View details of "+t},close:{ja:"\u9589\u3058\u308B",en:"Close"},yes:{ja:"\u306F\u3044",en:"Yes"},no:{ja:"\u3044\u3044\u3048",en:"No"},playAgain:{ja:"\u3082\u3046\u4E00\u5EA6\u30D7\u30EC\u30A4\u3059\u308B",en:"Play Again"},gameOver:{ja:"\u30B2\u30FC\u30E0\u30AA\u30FC\u30D0\u30FC",en:"Game Over"}};var ae="ja";function et(t){if(!t.displayState)return x(L,null);let e=t.displayState;return x("table",{class:"game-table",style:{"--dynamic-cell-size":"32px"}},e.grid.map((r,i)=>x("tr",{key:i},r.map((s,o)=>{let n=["game-cell"],l=i===e.player.r&&o===e.player.c,_=i===e.exit.r&&o===e.exit.c,c=s.isRevealed||_&&e.exitRevealedThisFloor;s.isObscured&&c&&n.push("game-cell--obscured");let h=p=>{c||(p.preventDefault(),T.toggleFlag(i,o),t.runGameLoop())},a="",u="",f="";return l?(f="@",s.isTrap?(n.push("game-cell--trap"),a="X"):(n.push("game-cell--player"),a=s.adjacentTraps===0?"":s.adjacentTraps.toString()),s.itemId&&(u="I"),_&&(u="E")):c?_?(n.push("game-cell--exit"),a="E"):s.itemId?(n.push("game-cell--item"),a="I"):s.isTrap?(n.push("game-cell--trap"),a="X"):(n.push("game-cell--revealed"),a=s.adjacentTraps===0?"":s.adjacentTraps.toString()):s.isFlagged?(n.push("game-cell--flagged"),a="\u2691"):n.push("game-cell--hidden"),x("td",{class:n.join(" "),onClick:h,onContextMenu:h,key:o},x("span",{class:"cell-number"+(l?"cell-number--player-present":"")},a),u&&x("span",{class:"cell-entity"},u),f&&x("span",{class:"cell-player-icon"},f))}))))}var T=new J;T.setupFloor();function $e(){let[t,e]=Pe(),r=i=>{if(i){let n=T.handleInput(i);"action"in n&&n.action==="next_floor_after_delay"&&(T.floorNumber++,T.setupFloor())}let s=T.gameLoop();if(console.log(s),document.body.dataset.gameState=s.gameState,s.gameState!="gameover"&&s.newItemAcquired){let n=s.newItemAcquired,l=`${Oe.itemAcquisition[ae]}: ${n.name[ae]}`;alert(l),T.clearJustAcquiredItem()}e(s.displayState);let o=s.gameState;if(o==="confirm_next_floor")r(confirm(s.message)?"yes":"no");else if(o==="choosing_item"){let n=parseInt(prompt(s.displayState.currentItemChoices.join(`
`))??"")}else o==="gameover"?alert(JSON.stringify(s.result)):["playing","jumping_direction","recon_direction"].includes(o);s.gameState!="gameover"&&s.lastActionMessage&&(alert(s.lastActionMessage[ae]),T.clearLastActionMessage()),["jumping_direction","recon_direction"].includes(o)&&s.message,s.message&&!["choosing_item","confirm_next_floor","jumping_direction","recon_direction"].includes(o)&&alert(s.message),s.gameState!="gameover"&&s.uiEffect,s.gameState!="gameover"&&s.tutorialToShow&&alert(s.tutorialToShow.title+`
`+s.tutorialToShow.content)};return qe(()=>{r();let i=s=>{let o=document.querySelector(".modal-overlay");if(s.key==="Escape"&&o){o.remove();return}if(o)return;let n=s.key.toLowerCase();switch(s.key){case"ArrowUp":n="w";break;case"ArrowDown":n="s";break;case"ArrowLeft":n="a";break;case"ArrowRight":n="d";break}let l=!0;T.gameState==="confirm_next_floor"||T.gameState==="choosing_item"||(["jumping_direction","recon_direction"].includes(T.gameState)?"wasd".includes(n)?r(n):l=!1:T.gameState==="playing"&&("wasd"+Object.values(k).map(h=>h.key).filter(h=>h).join("")).includes(n)?r(n):l=!1),l&&s.preventDefault()};return document.addEventListener("keydown",i),()=>{document.removeEventListener("keydown",i)}},[]),x("div",null,x(et,{displayState:t,runGameLoop:r}),x("button",{type:"button",onClick:()=>{r("w")}},"w"),x("button",{type:"button",onClick:()=>{r("a")}},"a"),x("button",{type:"button",onClick:()=>{r("s")}},"s"),x("button",{type:"button",onClick:()=>{r("d")}},"d"))}window.onload=()=>{document.getElementById("root").innerHTML="",Se(x($e,null),document.getElementById("root"))};
//# sourceMappingURL=preact_bundled.js.map
